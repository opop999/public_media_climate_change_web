LDAvis=function(t,e){var r,a,n,i,l,o={lambda:1,topic:0,term:""},s={old:1,current:1},c="#1f77b4",d="#d62728",u={top:30,right:30,bottom:70,left:30},p=t+"-lambda",$=t.split("#"),m=$[$.length-1],f=m+"-topic",y=m+"-lambda",x=m+"-term",h=f+"-down",g=f+"-up",b=f+"-clear";function v(t,e){return e=void 0===e?1:e,function(r,a){return r[t]<a[t]?1*e:r[t]>a[t]?-1*e:0}}d3.json(e,function(e,$){r=$.mdsDat.x.length,a=$.R,n=[];for(var _,T,A,B,w,E,k,I,q,S,C,z,L,M,F,G,H,P,D=0;D<r;D++){var R={};for(var W in $.mdsDat)R[W]=$.mdsDat[W][D];n.push(R)}i=[];for(var D=0;D<$["token.table"].Term.length;D++){var R={};for(var W in $["token.table"])R[W]=$["token.table"][W][D];i.push(R)}l=[];for(var D=0;D<$.tinfo.Term.length;D++){var R={};for(var W in $.tinfo)R[W]=$.tinfo[W][D];l.push(R)}_=f,T=y,A=m,(B=document.createElement("div")).setAttribute("id","top"),B.setAttribute("style","width: 1210px"),document.getElementById(A).appendChild(B),(w=document.createElement("div")).setAttribute("style","padding: 5px; background-color: #e8e8e8; display: inline-block; width: 530px; height: 50px; float: left"),B.appendChild(w),(E=document.createElement("label")).setAttribute("for",_),E.setAttribute("style","font-family: sans-serif; font-size: 14px"),E.innerHTML="Selected Topic: <span id='"+_+"-value'></span>",w.appendChild(E),(k=document.createElement("input")).setAttribute("style","width: 50px"),k.type="text",k.min="0",k.max=r,k.step="1",k.value="0",k.id=_,w.appendChild(k),(I=document.createElement("button")).setAttribute("id",h),I.setAttribute("style","margin-left: 5px"),I.innerHTML="Previous Topic",w.appendChild(I),(q=document.createElement("button")).setAttribute("id",g),q.setAttribute("style","margin-left: 5px"),q.innerHTML="Next Topic",w.appendChild(q),(S=document.createElement("button")).setAttribute("id",b),S.setAttribute("style","margin-left: 5px"),S.innerHTML="Clear Topic",w.appendChild(S),(C=document.createElement("div")).setAttribute("id","lambdaInput"),C.setAttribute("style","padding: 5px; background-color: #e8e8e8; display: inline-block; height: 50px; width: 530px; float: right; margin-right: 30px"),B.appendChild(C),(z=document.createElement("div")).setAttribute("style","padding: 5px; height: 20px; width: 220px; font-family: sans-serif; float: left"),z.setAttribute("id","lambdaZero"),C.appendChild(z),d3.select("#lambdaZero").append("text").attr("x",0).attr("y",0).style("font-size","14px").text("Slide to adjust relevance metric:"),d3.select("#lambdaZero").append("text").attr("x",125).attr("y",-5).style("font-size","10px").style("position","absolute").text("(2)"),(L=document.createElement("div")).setAttribute("id","sliderdiv"),L.setAttribute("style","padding: 5px; height: 40px; width: 250px; float: right; margin-top: -5px; margin-right: 10px"),C.appendChild(L),(M=document.createElement("input")).setAttribute("style","width: 250px; margin-left: 0px; margin-right: 0px"),M.type="range",M.min=0,M.max=1,M.step=$["lambda.step"],M.value=o.lambda,M.id=T,M.setAttribute("list","ticks"),L.appendChild(M),(F=document.createElement("label")).setAttribute("id","lamlabel"),F.setAttribute("for",T),F.setAttribute("style","height: 20px; width: 60px; font-family: sans-serif; font-size: 14px; margin-left: 80px"),F.innerHTML="&#955 = <span id='"+T+"-value'>"+o.lambda+"</span>",C.appendChild(F),G=d3.select("#sliderdiv").append("svg").attr("width",250).attr("height",25),H=d3.scale.linear().domain([0,1]).range([7.5,242.5]).nice(),P=d3.svg.axis().scale(H).orient("bottom").tickSize(10).tickSubdivide(!0).ticks(6),G.append("g").attr("class","slideraxis").attr("margin-top","-10px").call(P),d3.select(p).on("mouseup",function(){s.old=s.current,s.current=document.getElementById(y).value,o.lambda=+this.value,d3.select(p).property("value",o.lambda),d3.select(p+"-value").text(o.lambda);var t=s.old<o.lambda;o.topic>0&&td(t),t3(!0),document.getElementById(y).value=o.lambda}),d3.select("#"+g).on("click",function(){var t=document.getElementById(x+o.term);void 0!==t&&tf(t),o.term="";var e=document.getElementById(f).value,a=Math.min(r,+e+1).toFixed(0);document.getElementById(f).value=a,tp(document.getElementById(f+e)),tu(document.getElementById(f+a)),o.topic=a,t3(!0)}),d3.select("#"+h).on("click",function(){var t=document.getElementById(x+o.term);void 0!==t&&tf(t),o.term="";var e=document.getElementById(f).value,r=Math.max(0,+e-1).toFixed(0);document.getElementById(f).value=r,tp(document.getElementById(f+e)),tu(document.getElementById(f+r)),o.topic=r,t3(!0)}),d3.select("#"+f).on("keyup",function(){var t=document.getElementById(x+o.term);void 0!==t&&tf(t),o.term="",tp(document.getElementById(f+o.topic));var e=document.getElementById(f).value;!isNaN(e)&&e>0&&(e=Math.min(r,Math.max(1,e)),tu(document.getElementById(f+e)),o.topic=e,t3(!0),document.getElementById(f).value=o.topic)}),d3.select("#"+b).on("click",function(){tg(),t3(!0)});var Z=d3.extent(n,function(t){return t.x}),j=Z[1]-Z[0],Q=d3.extent(n,function(t){return t.y}),N=Q[1]-Q[0];if(j>N)var O=d3.scale.linear().range([0,530]).domain([Z[0]-.05*j,Z[1]+.05*j]),V=d3.scale.linear().range([530,0]).domain([Q[0]-.5*(j-N)-.05*j,Q[1]+.5*(j-N)+.05*j]);else var O=d3.scale.linear().range([0,530]).domain([Z[0]-.5*(N-j)-.05*N,Z[1]+.5*(N-j)+.05*N]),V=d3.scale.linear().range([530,0]).domain([Q[0]-.05*N,Q[1]+.05*N]);var J=d3.select(t).append("svg").attr("width",1060+u.left+90+u.right).attr("height",530+2*u.top+u.bottom+120),K=J.append("g").attr("id","leftpanel").attr("class","points").attr("transform","translate("+u.left+","+2*u.top+")");K.append("rect").attr("x",0).attr("y",0).attr("height",530).attr("width",530).style("fill",c).attr("opacity",0).on("click",function(){tg(),t3(!0)}),K.append("line").attr("x1",0).attr("x2",530).attr("y1",265).attr("y2",265).attr("stroke","gray").attr("opacity",.3),K.append("text").attr("x",0).attr("y",260).text($["plot.opts"].xlab).attr("fill","gray"),K.append("line").attr("x1",265).attr("x2",265).attr("y1",0).attr("y2",530).attr("stroke","gray").attr("opacity",.3),K.append("text").attr("x",270).attr("y",7).text($["plot.opts"].ylab).attr("fill","gray");var U=Math.sqrt(1404.5/Math.PI),X=Math.sqrt(3511.25/Math.PI),Y=Math.sqrt(7022.5/Math.PI),tt=10+Y,te=tt+1.5*Y;(circleGuide=function(t,e){d3.select("#leftpanel").append("circle").attr("class","circleGuide"+e).attr("r",t).attr("cx",tt).attr("cy",530+t).style("fill","none").style("stroke-dasharray","2 2").style("stroke","#999"),d3.select("#leftpanel").append("line").attr("class","lineGuide"+e).attr("x1",tt).attr("x2",te).attr("y1",530+2*t).attr("y2",530+2*t).style("stroke","gray").style("opacity",.3)})(U,"Small"),circleGuide(X,"Medium"),circleGuide(Y,"Large"),d3.select("#leftpanel").append("text").attr("x",10).attr("y",520).attr("class","circleGuideTitle").style("text-anchor","left").style("fontWeight","bold").text("Marginal topic distribtion"),d3.select("#leftpanel").append("text").attr("x",te+10).attr("y",530+2*U).attr("class","circleGuideLabelSmall").style("text-anchor","start").text("2%"),d3.select("#leftpanel").append("text").attr("x",te+10).attr("y",530+2*X).attr("class","circleGuideLabelMedium").style("text-anchor","start").text("5%"),d3.select("#leftpanel").append("text").attr("x",te+10).attr("y",530+2*Y).attr("class","circleGuideLabelLarge").style("text-anchor","start").text("10%");var tr=K.selectAll("points").data(n).enter();tr.append("text").attr("class","txt").attr("x",function(t){return O(+t.x)}).attr("y",function(t){return V(+t.y)+4}).attr("stroke","black").attr("opacity",1).style("text-anchor","middle").style("font-size","11px").style("fontWeight",100).text(function(t){return t.topics}),tr.append("circle").attr("class","dot").style("opacity",.2).style("fill",c).attr("r",function(t){return Math.sqrt(t.Freq/100*70225/Math.PI)}).attr("cx",function(t){return O(+t.x)}).attr("cy",function(t){return V(+t.y)}).attr("stroke","black").attr("id",function(t){return f+t.topics}).on("mouseover",function(t){var e=f+o.topic;o.topic>0&&e!=this.id&&tp(document.getElementById(e)),tu(this)}).on("click",function(t){d3.event.stopPropagation();var e=f+o.topic;o.topic>0&&e!=this.id&&tp(document.getElementById(e)),document.getElementById(f).value=o.topic=t.topics,t3(!0),tu(this)}).on("mouseout",function(t){o.topic!=t.topics&&tp(this),o.topic>0&&tu(document.getElementById(f+o.topic))}),J.append("text").text("Intertopic Distance Map (via multidimensional scaling)").attr("x",265+u.left).attr("y",30).style("font-size","16px").style("text-anchor","middle");var ta=l.filter(function(t){return"Default"==t.Category}),tn=d3.scale.ordinal().domain(ta.map(function(t){return t.Term})).rangeRoundBands([0,530],.15),ti=d3.scale.linear().domain([0,d3.max(ta,function(t){return t.Total})]).range([0,530]).nice();d3.svg.axis().scale(tn);var tl=J.append("g").attr("transform","translate("+ +(530+u.left+90)+","+2*u.top+")").attr("id","bar-freqs"),to={width:100,height:15};d3.select("#bar-freqs").append("rect").attr("x",0).attr("y",540).attr("height",to.height).attr("width",to.width).style("fill",c).attr("opacity",.4),d3.select("#bar-freqs").append("text").attr("x",to.width+5).attr("y",540+to.height/2).style("dominant-baseline","middle").text("Overall term frequency"),d3.select("#bar-freqs").append("rect").attr("x",0).attr("y",540+to.height+5).attr("height",to.height).attr("width",to.width/2).style("fill",d).attr("opacity",.8),d3.select("#bar-freqs").append("text").attr("x",to.width/2+5).attr("y",540+1.5*to.height+5).style("dominant-baseline","middle").text("Estimated term frequency within the selected topic"),d3.select("#bar-freqs").append("a").attr("xlink:href","http://vis.stanford.edu/files/2012-Termite-AVI.pdf").attr("target","_blank").append("text").attr("x",0).attr("y",540+3*to.height+5).style("dominant-baseline","middle").text("1. saliency(term w) = frequency(w) * [sum_t p(t | w) * log(p(t | w)/p(t))] for topics t; see Chuang et. al (2012)"),d3.select("#bar-freqs").append("a").attr("xlink:href","http://nlp.stanford.edu/events/illvi2014/papers/sievert-illvi2014.pdf").attr("target","_blank").append("text").attr("x",0).attr("y",540+4*to.height+5).style("dominant-baseline","middle").text("2. relevance(term w | topic t) = λ * p(w | t) + (1 - λ) * p(w | t)/p(w); see Sievert & Shirley (2014)");var ts=tl.selectAll(".bar-totals").data(ta).enter();ts.append("rect").attr("class","bar-totals").attr("x",0).attr("y",function(t){return tn(t.Term)}).attr("height",tn.rangeBand()).attr("width",function(t){return ti(t.Total)}).style("fill",c).attr("opacity",.4),ts.append("text").attr("x",-5).attr("class","terms").attr("y",function(t){return tn(t.Term)+12}).attr("cursor","pointer").attr("id",function(t){return x+t.Term}).style("text-anchor","end").text(function(t){return t.Term}).on("mouseover",function(){t$(this)}).on("mouseout",function(){o.term="",tf(this),t3(!0)}),tl.append("text").attr("x",265).attr("y",-30).attr("class","bubble-tool").style("text-anchor","middle").style("font-size","16px").text("Top-"+a+" Most Salient Terms").append("tspan").attr("baseline-shift","super").attr("font-size","12px").text("(1)");var tc=d3.svg.axis().scale(ti).orient("top").tickSize(-530).tickSubdivide(!0).ticks(6);function td(t){for(var e=l.filter(function(t){return t.Category=="Topic"+o.topic}),r=0;r<e.length;r++)e[r].relevance=o.lambda*e[r].logprob+(1-o.lambda)*e[r].loglift;e.sort(v("relevance"));var n=e.slice(0,a),i=d3.scale.ordinal().domain(n.map(function(t){return t.Term})).rangeRoundBands([0,530],.15),s=d3.scale.linear().domain([0,d3.max(n,function(t){return t.Total})]).range([0,530]).nice(),p=d3.select("#bar-freqs").selectAll(".bar-totals").data(n,function(t){return t.Term}),$=d3.select("#bar-freqs").selectAll(".terms").data(n,function(t){return t.Term}),m=d3.select("#bar-freqs").selectAll(".overlay").data(n,function(t){return t.Term}),f=d3.svg.axis().scale(s).orient("top").tickSize(-530).tickSubdivide(!0).ticks(6),y=d3.selectAll(".xaxis"),h=p.enter().append("rect").attr("class","bar-totals").attr("x",0).attr("y",function(t){return i(t.Term)+530+u.bottom+120}).attr("height",i.rangeBand()).style("fill",c).attr("opacity",.4),g=$.enter().append("text").attr("x",-5).attr("class","terms").attr("y",function(t){return i(t.Term)+12+530+u.bottom+120}).attr("cursor","pointer").style("text-anchor","end").attr("id",function(t){return x+t.Term}).text(function(t){return t.Term}).on("mouseover",function(){t$(this)}).on("mouseout",function(){o.term="",tf(this),t3(!0)}),b=m.enter().append("rect").attr("class","overlay").attr("x",0).attr("y",function(t){return i(t.Term)+530+u.bottom+120}).attr("height",i.rangeBand()).style("fill",d).attr("opacity",.8);t?(h.attr("width",function(t){return s(t.Total)}).transition().duration(750).delay(750).attr("y",function(t){return i(t.Term)}),g.transition().duration(750).delay(750).attr("y",function(t){return i(t.Term)+12}),b.attr("width",function(t){return s(t.Freq)}).transition().duration(750).delay(750).attr("y",function(t){return i(t.Term)}),p.transition().duration(750).attr("width",function(t){return s(t.Total)}).transition().duration(750).attr("y",function(t){return i(t.Term)}),$.transition().duration(750).delay(750).attr("y",function(t){return i(t.Term)+12}),m.transition().duration(750).attr("width",function(t){return s(t.Freq)}).transition().duration(750).attr("y",function(t){return i(t.Term)}),p.exit().transition().duration(750).attr("width",function(t){return s(t.Total)}).transition().duration(750).attr("y",function(t,e){return 530+u.bottom+6+18*e}).remove(),$.exit().transition().duration(750).delay(750).attr("y",function(t,e){return 530+u.bottom+18+18*e}).remove(),m.exit().transition().duration(750).attr("width",function(t){return s(t.Freq)}).transition().duration(750).attr("y",function(t,e){return 530+u.bottom+6+18*e}).remove(),y.transition().duration(750).call(f).transition().duration(750)):(h.attr("width",100).transition().duration(750).attr("y",function(t){return i(t.Term)}).transition().duration(750).attr("width",function(t){return s(t.Total)}),g.transition().duration(750).attr("y",function(t){return i(t.Term)+12}),b.attr("width",50).transition().duration(750).attr("y",function(t){return i(t.Term)}).transition().duration(750).attr("width",function(t){return s(t.Freq)}),p.transition().duration(750).attr("y",function(t){return i(t.Term)}).transition().duration(750).attr("width",function(t){return s(t.Total)}),$.transition().duration(750).attr("y",function(t){return i(t.Term)+12}),m.transition().duration(750).attr("y",function(t){return i(t.Term)}).transition().duration(750).attr("width",function(t){return s(t.Freq)}),p.exit().transition().duration(750).attr("y",function(t,e){return 530+u.bottom+6+18*e+120}).remove(),$.exit().transition().duration(750).attr("y",function(t,e){return 530+u.bottom+18+18*e+120}).remove(),m.exit().transition().duration(750).attr("y",function(t,e){return 530+u.bottom+6+18*e+120}).remove(),y.transition().duration(750).transition().duration(750).call(f))}function tu(t){if(null==t)return null;var e=t.__data__,r=Math.round(10*e.Freq)/10,n=e.topics;t.style.opacity=.6,t.style.fill=d,d3.select(".bubble-tool").remove(),d3.select("#bar-freqs").append("text").attr("x",265).attr("y",-30).attr("class","bubble-tool").style("text-anchor","middle").style("font-size","16px").text("Top-"+a+" Most Relevant Terms for Topic "+n+" ("+r+"% of tokens)");for(var i=l.filter(function(t){return t.Category=="Topic"+n}),o=0;o<i.length;o++)i[o].relevance=s.current*i[o].logprob+(1-s.current)*i[o].loglift;i.sort(v("relevance"));var u=i.slice(0,a),p=d3.scale.ordinal().domain(u.map(function(t){return t.Term})).rangeRoundBands([0,530],.15),$=d3.scale.linear().domain([0,d3.max(u,function(t){return t.Total})]).range([0,530]).nice();d3.selectAll(".overlay").remove(),d3.selectAll(".bar-totals").data(u).attr("x",0).attr("y",function(t){return p(t.Term)}).attr("height",p.rangeBand()).attr("width",function(t){return $(t.Total)}).style("fill",c).attr("opacity",.4),d3.selectAll(".terms").data(u).attr("x",-5).attr("y",function(t){return p(t.Term)+12}).attr("id",function(t){return x+t.Term}).style("text-anchor","end").text(function(t){return t.Term}),d3.select("#bar-freqs").selectAll(".overlay").data(u).enter().append("rect").attr("class","overlay").attr("x",0).attr("y",function(t){return p(t.Term)}).attr("height",p.rangeBand()).attr("width",function(t){return $(t.Freq)}).style("fill",d).attr("opacity",.8);var m=d3.svg.axis().scale($).orient("top").tickSize(-530).tickSubdivide(!0).ticks(6);d3.selectAll(".xaxis").call(m)}function tp(t){if(null==t)return t;t.style.opacity=.2,t.style.fill=c,d3.selectAll(".bubble-tool").text("Top-"+a+" Most Salient Terms").append("tspan").attr("baseline-shift","super").attr("font-size",12).text(1),d3.selectAll(".overlay").remove();var e=l.filter(function(t){return"Default"==t.Category}),r=d3.scale.ordinal().domain(e.map(function(t){return t.Term})).rangeRoundBands([0,530],.15),n=d3.scale.linear().domain([0,d3.max(e,function(t){return t.Total})]).range([0,530]).nice();d3.selectAll(".bar-totals").data(e).attr("x",0).attr("y",function(t){return r(t.Term)}).attr("height",r.rangeBand()).attr("width",function(t){return n(t.Total)}).style("fill",c).attr("opacity",.4),d3.selectAll(".terms").data(e).attr("x",-5).attr("y",function(t){return r(t.Term)+12}).style("text-anchor","end").text(function(t){return t.Term});var i=d3.svg.axis().scale(n).orient("top").tickSize(-530).tickSubdivide(!0).ticks(6);d3.selectAll(".xaxis").attr("class","xaxis").call(i)}function t$(t){var e=x+o.term;""!=o.term&&e!=t.id&&tf(document.getElementById(e)),o.term=t.innerHTML,tm(t),t3(!0)}function tm(t){if(null==t)return null;t.style.fontWeight="bold";for(var e=t.__data__.Term,a=i.filter(function(t){return t.Term==e}),l=a.length,o=[],s=0;s<r;++s)o[s]=0;for(s=0;s<l;s++)o[a[s].Topic-1]=a[s].Freq;for(var c=[],s=0;s<r;++s)c[s]=0;for(s=0;s<l;s++)c[a[s].Topic-1]=11;d3.scale.sqrt().domain([0,1]).range([0,60]),d3.selectAll(".dot").data(o).transition().attr("r",function(t){return Math.sqrt(70225*t/Math.PI)}),d3.selectAll(".dot").data(n),d3.selectAll(".txt").data(c).transition().style("font-size",function(t){return+t}),d3.select(".circleGuideTitle").text("Conditional topic distribution given term = '"+t.innerHTML+"'")}function tf(t){if(null==t)return null;t.style.fontWeight="normal",d3.selectAll(".dot").data(n).transition().attr("r",function(t){return Math.sqrt(t.Freq/100*70225/Math.PI)}),d3.selectAll(".txt").transition().style("font-size","11px"),d3.select(".circleGuideTitle").text("Marginal topic distribution"),d3.select(".circleGuideLabelLarge").text("10%"),d3.select(".circleGuideLabelSmall").attr("y",530+2*U).text("2%"),d3.select(".circleGuideSmall").attr("r",U).attr("cy",530+U),d3.select(".lineGuideSmall").attr("y1",530+2*U).attr("y2",530+2*U)}tl.attr("class","xaxis").call(tc);var ty=location.hash.split("&");if(ty.length>1){o.topic=ty[0].split("=")[1],o.lambda=ty[1].split("=")[1],o.term=ty[2].split("=")[1],o.topic=Math.round(Math.min(r,Math.max(0,o.topic))),o.lambda=Math.min(1,Math.max(0,o.lambda)),document.getElementById(y).value=o.lambda,document.getElementById(y+"-value").innerHTML=o.lambda,!isNaN(o.topic)&&(document.getElementById(f).value=o.topic,o.topic>0&&tu(document.getElementById(f+o.topic)),o.lambda<1&&o.topic>0&&td(!1)),s.current=o.lambda;var tx=document.getElementById(x+o.term);void 0!==tx&&tm(tx)}function th(){return location.origin+location.pathname+"#topic="+o.topic+"&lambda="+o.lambda+"&term="+o.term}function t3(t){t?history.replaceState(o,"Query",th()):history.pushState(o,"Query",th())}function tg(){o.topic>0&&tp(document.getElementById(f+o.topic)),""!=o.term&&tf(document.getElementById(x+o.term)),o.term="",document.getElementById(f).value=o.topic=0,t3(!0)}})};